<div class="max-w-2xl mx-auto p-6">
  <!-- Header -->
  <app-form-header
    backRoute="/pets"
    [title]="isEditMode ? 'Editar Pet' : 'Cadastrar Novo Pet'">
  </app-form-header>

  @if (errorMessage) {
    <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3 animate-fadeIn">
      <span class="text-red-600 text-xl">⚠️</span>
      <div class="flex-1">
        <p class="text-red-800 font-medium">Erro ao salvar</p>
        <p class="text-red-600 text-sm mt-1">{{ errorMessage }}</p>
      </div>
      <button
        (click)="errorMessage = null"
        class="text-red-400 hover:text-red-600 text-xl leading-none"
        aria-label="Fechar mensagem de erro">
        ×
      </button>
    </div>
  }

  <!-- Formulário -->
  <form [formGroup]="petForm" (ngSubmit)="onSubmit()" class="bg-white rounded-xl shadow-lg p-8 space-y-6">
    <app-image-upload
      [previewUrl]="previewUrl"
      (fileSelected)="handleFileSelected($event)">
    </app-image-upload>

    <!-- Nome -->
    <div>
      <label for="nome" class="block text-sm font-medium text-gray-700 mb-2">
        Nome do Pet *
      </label>
      <input
        id="nome"
        type="text"
        formControlName="nome"
        placeholder="Ex: Rex"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg
               focus:ring-2 focus:ring-blue-500 focus:outline-none"
        [class.border-red-500]="nomeControl?.invalid && nomeControl?.touched"
      />
      @if (nomeControl?.invalid && nomeControl?.touched) {
        <p class="mt-1 text-sm text-red-600">
          @if (nomeControl?.errors?.['required']) {
            Nome é obrigatório
          } @else if (nomeControl?.errors?.['minlength']) {
            Nome deve ter pelo menos 2 caracteres
          }
        </p>
      }
    </div>

    <!-- Raça -->
    <div>
      <label for="raca" class="block text-sm font-medium text-gray-700 mb-2">
        Raça *
      </label>
      <input
        id="raca"
        type="text"
        formControlName="raca"
        placeholder="Ex: Labrador"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg
               focus:ring-2 focus:ring-blue-500 focus:outline-none"
        [class.border-red-500]="racaControl?.invalid && racaControl?.touched"
      />
      @if (racaControl?.invalid && racaControl?.touched) {
        <p class="mt-1 text-sm text-red-600">Raça é obrigatória</p>
      }
    </div>

    <!-- Idade -->
    <div>
      <label for="idade" class="block text-sm font-medium text-gray-700 mb-2">
        Idade (anos) *
      </label>
      <input
        id="idade"
        type="number"
        formControlName="idade"
        placeholder="Ex: 3"
        min="0"
        max="30"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg
               focus:ring-2 focus:ring-blue-500 focus:outline-none"
        [class.border-red-500]="idadeControl?.invalid && idadeControl?.touched"
      />
      @if (idadeControl?.invalid && idadeControl?.touched) {
        <p class="mt-1 text-sm text-red-600">
          @if (idadeControl?.errors?.['required']) {
            Idade é obrigatória
          } @else if (idadeControl?.errors?.['min'] || idadeControl?.errors?.['max']) {
            Idade deve estar entre 0 e 30 anos
          }
        </p>
      }
    </div>

    <app-form-actions
      cancelRoute="/pets"
      [loading$]="loading$"
      [isEditMode]="isEditMode"
      submitLabel="Cadastrar Pet"
      editLabel="Salvar Alterações">
    </app-form-actions>
  </form>
</div>
